global:
  scrape_interval: 15s
  evaluation_interval: 15s
  external_labels:
    env: 'production'

rule_files:
  - 'rules/*.yml'

alerting:
  alertmanagers:
    - static_configs:
        - targets: [] # Add alertmanager:9093 if deployed

scrape_configs:
  # --- Controller (Spring Boot) ---
  - job_name: 'controller'
    metrics_path: '/actuator/prometheus'
    scrape_interval: 10s
    static_configs:
      - targets: ['controller:8080']
    relabel_configs:
      - source_labels: [__address__]
        target_label: instance
        regex: '([^:]+)(?::\d+)?'
        replacement: '${1}'

  # --- Admission Service (Go) ---
  - job_name: 'admission'
    metrics_path: '/metrics'
    scrape_interval: 5s # Higher resolution for admission control
    static_configs:
      - targets: ['admission:9091']

  # --- Workers (Rust) ---
  - job_name: 'worker'
    metrics_path: '/metrics'
    static_configs:
      - targets: ['worker:8080'] # Assuming worker exposes metrics on 8080 or uses pushgateway
    # Use service discovery in K8s:
    # kubernetes_sd_configs: ...

  # --- Infrastructure ---
  - job_name: 'prometheus'
    static_configs:
      - targets: ['localhost:9090']

  - job_name: 'redis'
    static_configs:
      - targets: ['redis-exporter:9121']



